<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="es.css">
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <style>
       body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f5f5f5;
}

.navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: rgb(149, 79, 79);
    padding: 15px;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1000;
}
.navbar .company-name {
           color: #fff;
           text-decoration: none;
           font-size: 1.5em;
       }
       .navbar .menu-item, .navbar .dropdown button {
           color: #fff;
           text-decoration: none;
           margin-left: 15px;
       }

.container {
    margin-top: 80px; /* Add top margin to avoid overlapping with the fixed navbar */
}

.company-name {
    color: #fff;
    font-size: 24px;
    text-decoration: none;
    font-weight: bold;
}

.navbar-right {
    display: flex;
    align-items: center;
}

.menu-item,
.dropbtn {
    color: white;
    padding: 14px 20px;
    text-decoration: none;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 18px;
}

.menu-item:hover,
.dropbtn:hover {
    background-color: #555;
}

.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #fff;
    min-width: 160px;
    box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
    z-index: 1;
}

.dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    font-size: 16px;
}

.dropdown-content a:hover {
    background-color: #f1f1f1;
}

.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown:hover .dropbtn {
    background-color: #555;
}

/* Flex container styling */
.flex-container {
           display: flex;
           justify-content: space-between;
           align-items: center;
           margin-bottom: 15px;
       }
  /* Search input styling */
  #searchInput {
           margin-top: 10px;
           width: 100%;
           padding: 10px;
           border-radius: 4px;
           border: 1px solid #ccc;
       }
         /* Modal button styling */
       #createEmployeeBtn {
           padding: 10px 20px;
           background-color:brown;
           color: white;
           border: none;
           border-radius: 4px;
           cursor: pointer;
       }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-left">
            <a href="#" class="company-name">UnicomTIC</a>
        </div>
        <div class="navbar-right">
            <a href="../employees/index.html" class="menu-item">Employee</a>
            <div class="dropdown">
                <button class="dropbtn">Leave Management</button>
                <div class="dropdown-content">
                    <a href="../leaves/leaveRequest.html">Apply Leave</a>
                    <a href="../leaves/managerLeaveManagement.html">Manage Leave</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="flex-container">
            <h1>Employee Management</h1>
            <!-- Add Employee Button -->
            <button id="createEmployeeBtn">Add Employee</button>
        </div>
        <!-- Search Input -->
        <input type="text" id="searchInput" placeholder="Search by NIC, First Name, Last
Name..." style="margin-top: 10px;">
        <!-- Employee Table -->
        <table id="employeeTable">
            <thead>
                <tr>
                    <th>EMP ID</th>
                    <th>NIC</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Date of Birth</th>
                    <th>Date of Joining</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="employeeTableBody"></tbody>
        </table>
        <br>
        <!-- Toast Notification -->
        <div id="toast"></div>
        <!-- Employee Modal -->
        <div id="employeeModal" class="modal" style="display: none;">
            <div class="modal-content" style="padding: 20px; border: 1px solid #ccc; background-color: #fff; max-width: 400px; margin: auto;">
                <span class="close" style="float: right; font-size: 24px; cursor: pointer;">&times;</span>
                <h2 id="modalTitle" style="font-size: 18px; margin-bottom: 10px;">Add Employee</h2>
                <form id="employeeForm">
                    <input type="hidden" id="empId" name="empId">
                    <div style="margin-bottom: 10px;">
                        <label for="nic">NIC Number:</label>
                        <input type="text" id="nic" name="nic" required style="width: 100%; padding: 8px;">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label for="firstName">First Name:</label>
                        <input type="text" id="firstName" name="firstName" required style="width: 100%; padding: 8px;">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label for="lastName">Last Name:</label>
                        <input type="text" id="lastName" name="lastName" required style="width: 100%; padding: 8px;">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label for="dob">Date of Birth:</label>
                        <input type="date" id="dob" name="dob" required style="width: 100%; padding: 8px;">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label for="doj">Date of Joining:</label>
                        <input type="date" id="doj" name="doj" required style="width: 100%; padding: 8px;">
                    </div>
                    <button type="submit" id="saveButton" style="width: 100%; padding: 10px; background-color: brown; color: white; border: none;">Save</button>
                </form>
            </div>
        </div>
        <!-- Credentials Modal -->
<div id="credentialsModal" class="modal" style="display: none;">
    <div class="modal-content" style="padding: 20px; border: 1px solid #ccc; background-color: #fff; max-width: 400px; margin: auto;">
        <span class="close" style="float: right; font-size: 24px; cursor: pointer;">&times;</span>
        <h2 style="font-size: 18px; margin-bottom: 10px;">Edit Credentials</h2>
        <form id="credentialsForm">
            <input type="hidden" id="credentialsEmpId" name="empId">
            <div style="margin-bottom: 10px;">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" disabled required style="width: 100%; padding: 8px;">
            </div>
            <div style="margin-bottom: 10px;">
                <label for="password">Password:</label>
                <input type="text" id="password" name="password" required style="width: 100%; padding: 8px;">
            </div>
            <div style="margin-bottom: 10px;">
                <label for="userrole">Role:</label>
                <select id="userrole" name="userrole" style="width: 100%; padding: 8px;">
                    <option value="Employee">Employee</option>
                    <option value="Manager">Manager</option>
                    <option value="Admin">Admin</option>
                    <option value="Director">Director</option>
                </select>
            </div>
            <button type="submit" style="width: 100%; padding: 10px; background-color: brown; color: white; border: none;">Save Credentials</button>
        </form>
    </div>
</div>

        
    <script>
          document.addEventListener("DOMContentLoaded", async () => {

const apiUrl = "http://localhost:3000/employees";
const userApiUrl = "http://localhost:3000/users";

let employees = [];
let users = [];
let editingEmployeeId = null;
const employeeTableBody = document.getElementById("employeeTableBody");
const employeeModal = document.getElementById("employeeModal");
const credentialsModal = document.getElementById("credentialsModal");
const employeeForm = document.forms['employeeForm'];
const credentialsForm = document.forms['credentialsForm'];
const toast = document.getElementById("toast");
// Fetch Employees
const fetchEmployees = async () => {
    const response = await fetch(apiUrl);
    employees = await response.json();
    renderEmployees();
};
// Fetch Users
const fetchUsers = async () => {
    const response = await fetch(userApiUrl);
    users = await response.json();
};
// Render Employees
const renderEmployees = () => {
    employeeTableBody.innerHTML = "";
    employees.forEach((employee) => {
        const row = document.createElement("tr");
        row.innerHTML = `
<td>${employee.employeeId}</td>
<td>${employee.nic}</td>
<td>${employee.firstName}</td>
<td>${employee.lastName}</td>
<td>${employee.dob}</td>
<td>${employee.doj}</td>
<td>
<button onclick="editEmployee('${employee.employeeId}')">Edit</button>
<button onclick="deleteEmployee('${employee.employeeId}')">Delete</button>
<button onclick="editCredentials('${employee.employeeId}')">Edit
Credentials</button>
</td>
`;
        employeeTableBody.appendChild(row);
    });
};
// Open Employee Modal for Create or Edit
document.getElementById("createEmployeeBtn").onclick = () => {
    openEmployeeModal();
};
const openEmployeeModal = (employee = null) => {
    employeeModal.style.display = "block";
    const modalTitle = document.getElementById("modalTitle");
    const saveButton = document.getElementById("saveButton");
    if (employee) {
        modalTitle.innerText = "Edit Employee";
        saveButton.innerText = "Update";
        employeeForm.nic.value = employee.nic;
        employeeForm.firstName.value = employee.firstName;
        employeeForm.lastName.value = employee.lastName;
        employeeForm.dob.value = employee.dob;
        employeeForm.doj.value = employee.doj;
        editingEmployeeId = employee.employeeId;
    } else {
        employeeForm.reset();
        modalTitle.innerText = "Add Employee";
        saveButton.innerText = "Save";
        editingEmployeeId = null;
    }
};
// Close Modal
document.querySelectorAll(".close").forEach(btn => {
    btn.onclick = () => {
        employeeModal.style.display = "none";
        credentialsModal.style.display = "none";
    };
});
// Function to generate unique EMP ID
const generateEmpId = () => {
    const characters =
        'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let empId;
    do {
        empId = 'EMP_' + Array.from({ length: 5 }, () =>
            characters.charAt(Math.floor(Math.random() * characters.length))).join('');
    } while (employees.some(emp => emp.empId === empId));
    return empId;
};
// Save Employee
employeeForm.onsubmit = async (e) => {
    e.preventDefault();
    const empId = editingEmployeeId || generateEmpId();
    const nic = employeeForm.nic.value;
    const firstName = employeeForm.firstName.value;
    const lastName = employeeForm.lastName.value;
    const dob = employeeForm.dob.value;
    const doj = employeeForm.doj.value;

    const employeeData = {
        id: empId,
        employeeId: empId,
        nic: nic,
        firstName: firstName,
        lastName: lastName,
        dob: dob,
        doj: doj
    };

    if (editingEmployeeId) {
        // Update employee
        await fetch(`${apiUrl}/${editingEmployeeId}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(employeeData)
        });
    } else {
        // Create new employee
        await fetch(apiUrl, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(employeeData)
        });
        // Automatically create user credentials
        const userData = {
            id: empId,
            employeeId: empId,
            username: empId,
            password: "pwd123",
            role: "Employee" // Default role as Employee; can be modified as needed
        };
        await fetch(userApiUrl, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(userData)
        });
    }
    employeeModal.style.display = "none";
    await fetchEmployees();
    await fetchUsers(); // To refresh user data if needed
};
// Delete Employee
window.deleteEmployee = async (empId) => {
    if (confirm("Are you sure you want to delete this employee?")) {
        await fetch(`${apiUrl}/${empId}`, {
            method: "DELETE"
        });
        await fetch(`${userApiUrl}/${empId}`, {
            method: "DELETE"
        });
        showToast("Deleted Successfully");
        await fetchEmployees();
    }
};
// Edit Employee
window.editEmployee = (empId) => {
    const employee = employees.find(emp => emp.employeeId === empId);
    openEmployeeModal(employee);
};
// Open Credentials Modal
window.editCredentials = (empId) => {
    const user = users.find(usr => usr.employeeId === empId);
    if (user) {
        credentialsModal.style.display = "block";
        credentialsForm.username.value = user.username;
        credentialsForm.password.value = user.password;
        credentialsForm.userrole.value = user.role;
        credentialsForm.credentialsEmpId.value = user.employeeId;
    }
};
// Save Credentials
credentialsForm.onsubmit = async (e) => {
    e.preventDefault();
    const userData = {
        username: credentialsForm.username.value,
        password: credentialsForm.password.value,
        role: credentialsForm.userrole.value,
        employeeId: credentialsForm.credentialsEmpId.value
    };
    const user = users.find(usr => usr.employeeId === userData.employeeId);
    if (user) {
        await fetch(`${userApiUrl}/${user.id}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(userData)
        });
    } else {
        await fetch(userApiUrl, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(userData)
        });
    }
    credentialsModal.style.display = "none";
    await fetchUsers();
};
// Show Toast
const showToast = (message) => {
    toast.innerText = message;
    toast.classList.add("show");
    setTimeout(() => {
        toast.classList.remove("show");
    }, 3000);
};
// Search Employees
document.getElementById("searchInput").oninput = (e) => {
    const query = e.target.value.toLowerCase();
    const filteredEmployees = employees.filter(emp => {
        return emp.nic.toLowerCase().includes(query) ||
            emp.firstName.toLowerCase().includes(query) ||
            emp.lastName.toLowerCase().includes(query);
    });
    renderFilteredEmployees(filteredEmployees);
};
const renderFilteredEmployees = (filteredEmployees) => {
    employeeTableBody.innerHTML = "";
    filteredEmployees.forEach((employee) => {
        const row = document.createElement("tr");
        row.innerHTML = `
<td>${employee.employeeId}</td>
<td>${employee.nic}</td>
<td>${employee.firstName}</td>
<td>${employee.lastName}</td>
<td>${employee.dob}</td>
<td>${employee.doj}</td>
<td>
<button onclick="editEmployee('${employee.employeeId}')">Edit</button>
<button onclick="deleteEmployee('${employee.employeeId}')">Delete</button>
<button onclick="editCredentials('${employee.employeeId}')">Edit
Credentials</button>
</td>
`;
        employeeTableBody.appendChild(row);
    });
};
// Initialize
fetchEmployees();
fetchUsers();
});

 // Show and hide modal logic
 document.querySelectorAll(".close").forEach(closeBtn => {
        closeBtn.addEventListener("click", () => {
            closeBtn.closest(".modal").style.display = "none";
        });
    });

    // For demo purposes, to open the modal when testing
    document.getElementById("createEmployeeBtn").onclick = () => {
        document.getElementById("employeeModal").style.display = "flex";
    };

    </script>
</body>
</html>
    
      
